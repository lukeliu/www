<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>國立臺灣大學醫學院附設醫院新竹臺大分院</title>
    <meta content="" name="descriptison">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="images/favicon.png" rel="icon">
    <link href="images/favicon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
    <link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="assets/vendor/slick/slick.css" rel="stylesheet">
    <link href="assets/vendor/slick/slick-theme.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="assets/css/custom.css" rel="stylesheet">
</head>

<body class="successive_deans">

    <!-- ======= Header ======= -->
    <header id="header">
        <button type="button" class="mobile-nav-toggle d-lg-none"><i class="bx bx-menu"></i></button>
        <div class="container full">

            <div class="row no-gutters">
                <div class="col-6">
                    <div class="logo">
                        <a class="d-block" href="https://www.hch.gov.tw/" target="_blank"><img src="images/logo.png" alt="國立臺灣大學醫學院附設醫院新竹台大分院" class="img-fluid"></a>
                        <a class="tohome" href="index.html" data-storke="回首頁">回首頁</a>
                    </div>
                </div>
                <div class="col-6">
                    <nav class="nav-menu d-none d-lg-block">
                        <ul>
                            <li class="m_show"><a href="index.html" data-storke="回首頁">回首頁</a></li>
                            <li class="active"><a href="index.html" data-storke="歷任院長">歷任院長</a></li>
                            <li><a href="academy_history.html" data-storke="新竹臺大分院歷史沿革">新竹臺大分院歷史沿革</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="col-12 h_title"><img class="img-fluid" data-aos="fade-up" src="images/h_title4.png" alt=""></div>
            </div>

        </div>
    </header>
    <!-- End Header -->

    <main id="main" class="">

        <!-- ======= History Section ======= -->
        <section class="History p-0">
            <div class="container full">

                <div class="position-relative">
                    <div class="btns">
                        <div class="btn line_1" item="item01">新竹醫院</div>
                        <div class="btn line_2" item="item31">竹東醫院</div>
                        <div class="btn line_3" item="item41">新竹生醫園區分院</div>
                        <div class="btn line_4" item="item42">臺大分院</div>
                    </div>
                    <div id="history1">
                        <div id="svgAll"><svg class="connection-svg"></svg></div>
                        <img class="img-fluid pic1" src="images/hospital.png" data-aos="fade-up" alt="">
                        <img class="img-fluid pic2" src="images/hospital2.png" data-aos="fade-up" alt="">
                        <img class="img-fluid pic3" src="images/hospital3.png" data-aos="fade-up" alt="">

                        <div class="otime ot01"><span>日治時期</span></div>
                        <div class="otime ot02 hide"><span>民國前10年</span></div>
                        <div class="otime ot03 hide"><span>民國元年</span></div>
                        <div class="otime ot04 hide"><span>民國10年</span></div>
                        <div class="otime ot05 hide"><span>民國20年</span></div>
                        <div class="otime ot06"><span>臺灣省立時期<br>(光復後時期)</span></div>
                        <div class="otime ot07 hide"><span>民國40年</span></div>
                        <div class="otime ot08 hide"><span>民國50年</span></div>
                        <div class="otime ot09 hide"><span>民國60年</span></div>
                        <div class="otime ot10 hide"><span>民國70年</span></div>
                        <div class="otime ot11"><span>行政院衛生署時期</span></div>
                        <div class="otime ot12 hide"><span>民國90年</span></div>
                        <div class="otime ot13"><span>臺大醫院時期</span></div>
                        <div class="otime ot14"><span>民國108年</span></div>
                        <div class="otime ot15"><span>民國110年<br>三院整併</span></div>
                        <div class="otime ot16"><span>民國115年</span></div>
                        
                        <ul id="hr_list"></ul>
                    </div>
                    <!-- <div id="float_nav" class="niceScroll"></div> -->
                </div>
            </div>
                <div class="bg3"><img src="images/btm_bg1.jpg" class="img-fluid" alt=""></div>

        </section>
        <!-- End History Section -->

    </main>
    <!-- End #main -->

    <!-- ======= Footer ======= -->
    <footer id="footer">
        <div class="footer-top">
            <div class="container full">
                <div class="row no-gutters justify-content-center">

                    <div class="col-xl-5 col-md-9">
                        <div class="footer-info">
                            <a href="https://www.hch.gov.tw/" target="_blank"><img class="logo_td" data-aos="fade-right" src="images/logo.png" alt="國立臺灣大學醫學院附設醫院新竹臺大分院"></a>
                            <h3>國立臺灣大學醫學院<br class="m_show">附設醫院新竹臺大分院</h3>
                            <p>地址：302058新竹縣竹北市生醫路一段2號</p>
                            <p>新竹醫院：300195新竹市經國路一段442巷25號</p>
                            <p>生醫醫院竹北院區：302058新竹縣竹北市生醫路一段2號</p>
                            <p>生醫醫院竹東院區：310402新竹縣竹東鎮至善路52號</p>
                        </div>
                    </div>
                    <div class="col-xl-6 footer-links">
                        <div class="row no-gutters justify-content-center">
                            <div class="footer-link">
                                <h4>
                                    <a class="active" href="index.html">歷任院長</a>
                                </h4>
                            </div>
                            <div class="footer-link">
                                <h4>
                                    <a href="academy_history.html">新竹臺大分院歷史沿革</a>
                                </h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- End Footer -->

    <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

    <!-- Modal -->
    <div class="modal fade" id="showModal" tabindex="-1" role="dialog" aria-labelledby="showModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row no-gutters">

                        <div class="col-lg-3 infomation">
                            <div id="infomation">
                                <p id="Label_Date" class="time"></p>
                                <p id="Label_Subject_hospital" class="hospital"></p>
                                <p class="title">
                                    <span id="Label_Subject_title" class="info"></span>
                                </p>
                                <p id="Label_Subject_period" class="period"></p>
                                <p id="Label_Summary" class="Summary"></p>
                            </div>
                        </div>

                        <div class="col-lg-9 imglists">
                            <div id="simple-bar">
                                <div id="Big_Photo">
                                </div>
                                <div id="List_Photo">
                                    <div class="scroll"></div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div id="button_left"><img src="images/button_left.png" alt="" class="img-fluid"></div>
                    <div id="button_right"><img src="images/button_right.png" alt="" class="img-fluid"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Modal -->

    <!-- Vendor JS Files -->
    <script src="assets/vendor/jquery/jquery.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/slick/slick.min.js"></script>
    <script src="assets/js/jquery.niceScroll.min.js"></script>
    <script src="assets/vendor/jquery.mCustomScrollbar/jquery.mCustomScrollbar.js"></script>
    <script src="assets/vendor/jquery.mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js"></script>

    <!-- Template Main JS File -->
    <script src="assets/js/extm.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="data/Data4.js?1"></script>
    <script>
        // 核心連線生成函數
        function connectionLines(containerSelector, selector1, selector2, Line, style, i) {
            const $container = $(containerSelector);
            const $container2 = $('#svgAll');
            const $el1 = $(selector1);
            const $el2 = $(selector2);
            const f_right = [37, 38, 41];
            
            // 移除已有SVG避免重複
            //$container2.find('svg.connection-svg').remove();
            
            // SVG容器
            const $svg = $('#svgAll .connection-svg');
            //$container2.append($svg);

            // 獲取元素中心座標（相對容器）
            function getElementCenter($el) {
                const containerOffset = $container.offset();
                const elOffset = $el.offset();
                const containerLeft = containerOffset.left;
                const containerTop = containerOffset.top;
                const elLeft = elOffset.left;
                const elTop = elOffset.top;
                const elWidth = $el.outerWidth();
                const elHeight = $el.outerHeight();
                
                // 計算相對容器的坐標
                let elX = (elLeft - containerLeft) + elWidth / 2;
                if (elWidth > 48) {
                    elX = elLeft - containerLeft; // 寬度超48px時取左邊界
                }
                if (i == 42) {
                    elX = (elLeft - containerLeft) + elWidth / 2; // 錯開疊線
                }
                if (i == 43 || i == 32) {
                    elX = (elLeft - containerLeft) + elWidth / 3.5; // 錯開疊線
                }
                for(var j = 0; j < f_right.length; j++){
                    if(i === f_right[j]){
                        elX = elLeft - containerLeft + elWidth; // 取右邊界
                        //console.log(f_right[j]+': '+elX);
                    }
                }
                const elY = (elTop - containerTop) + elHeight / 2;
                
                return { x: elX, y: elY };
            }

            // 繪製所有連線
            function drawAllLines() {
                //$svg.empty(); // 清空原有連線
                const center1 = getElementCenter($el1);
                const center2 = getElementCenter($el2);

                // 創建SVG路徑的工具函數
                function createPath(d) {
                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    path.setAttribute("d", d);
                    path.setAttribute("id", "p-"+i);
                    path.setAttribute("class", Line);
                    return path;
                }

                var path1;

                switch(style) {
                    case 'hv':
                        // 先橫後豎
                        path1 = createPath(`M ${center1.x} ${center1.y} H ${center2.x} V ${center2.y}`);
                        break;
                        
                    case 'vh':
                        // 先豎後橫
                        path1 = createPath(`M ${center1.x} ${center1.y} V ${center2.y} H ${center2.x}`);
                        break;
                        
                    case 'hvh':
                        // 先橫後豎再橫（中間中轉點）
                        var midX1 = (center1.x + center2.x) / 2;
                        path1 = createPath(`M ${center1.x} ${center1.y} H ${midX1} V ${center2.y} H ${center2.x}`);
                        break;
                        
                    case 'vhv':
                        // 先豎後橫再豎（中間中轉點）
                        var midY1 = (center1.y + center2.y) / 2;
                        path1 = createPath(`M ${center1.x} ${center1.y} V ${midY1} H ${center2.x} V ${center2.y}`);
                        break;
                }

                // 添加所有路徑到SVG
                //console.log(path1);
                $svg.append(path1);
            }

            // 初始化繪製
            drawAllLines();
        }

        $(function() {

            function getUrlVal(val) {
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for(var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split("=");
                    if(pair[0] == val) {
                        return pair[1];
                    }
                }
                return (false);
            }
            var TYear = getUrlVal('hr');
            var toshow = getUrlVal('toshow');
            var len = Object.keys(_Data).length;

            if($(".niceScroll").length > 0){
                $(".niceScroll").niceScroll({
                    cursorcolor:"#999",
                    autohidemode: false
                });
            }

            // Func : SetHTML
            // Desc : 設定歷史河流的內容
            function SetListHTML() {
                var w_len = 0;
                for(var i = 1; i <= len; i++) {
                    var tindex = '';
                    if(i < 10){
                        tindex = '0' + i.toString();
                    }else{
                        tindex = i.toString();
                    }
                    var dbData = _Data[tindex];
                    var year = '';
                    var time = dbData['date'];
                    var hospital = dbData['subject']['hospital'];
                    var title = dbData['subject']['title'];
                    var period = dbData['subject']['period'];

                    var dean = dbData['dean'];
                    if(dean == undefined){
                        dean = '';
                    }else{
                        dean = 'data/Official/4/'+ dean;
                    }
                    var smallpic = dbData['smallpic'];
                    if(smallpic == undefined){
                        smallpic = '';
                    }else{
                        smallpic = 'data/Official/4/'+ smallpic;
                    }
                    var sort = 'sort' + dbData['sort'];
                    
                    if(dean.length > 0){
                        if(smallpic.length > 0){
                            $('#hr_list').append('<li id="item'+ tindex +'" class="h_link pointer '+ sort +'" data-toggle="modal" data-target="#showModal" data-index="'+ tindex +'"><div class="point1"></div><span class="hospital">'+ hospital +'</span><span class="title">'+ title +'</span><span class="period">'+ period +'</span><img class="dean" src="'+ dean +'.webp" alt="'+ title +'"><img class="smallpic" src="'+ smallpic +'_s.webp" alt="'+ title +'"></li>');
                        }else{
                            $('#hr_list').append('<li id="item'+ tindex +'" class="h_link '+ sort +'" data-index="'+ tindex +'"><div class="point1"></div><span class="hospital">'+ hospital +'</span><span class="title">'+ title +'</span><span class="period">'+ period +'</span><img class="dean" src="'+ dean +'.webp" alt="'+ title +'"></li>');                            
                        }
                    }else{
                        if(smallpic.length > 0){
                            $('#hr_list').append('<li id="item'+ tindex +'" class="h_link pointer '+ sort +'" data-toggle="modal" data-target="#showModal" data-index="'+ tindex +'"><div class="point1"></div><span class="hospital">'+ hospital +'</span><span class="title">'+ title +'</span><span class="period">'+ period +'</span><img class="smallpic" src="'+ smallpic +'_s.webp" alt="'+ title +'"></li>');
                        }else{
                            $('#hr_list').append('<li id="item'+ tindex +'" class="h_link '+ sort +'" data-index="'+ tindex +'"><div class="point1"></div><span class="hospital">'+ hospital +'</span><span class="title">'+ title +'</span><span class="period">'+ period +'</span></li>');
                        }
                    }
            }
                
            }
            function toSHOW(){
                $('#hr_list .h_link').each(function() {
                    var h_link = $(this);
                    var dindex = h_link.attr('data-index');
                    // console.log(dindex + ' === ' + toshow);
                    if (dindex === toshow) {
                        var lpos = h_link.position();
                        // console.log(lpos.top);
                        var mv = -200;
                        $('html, body').animate({
                            scrollTop: lpos.top - mv
                        }, 1500, 'easeInOutExpo');
                        function tclick(){
                            h_link.click();
                        }
                        window.setTimeout(tclick, 2000);
                        return false;
                    }
                });
            }
            window.setTimeout(toSHOW, 2000);

            var index = "";
            var urls = ['第2任河田守恭','第3任蒲地佐惣太','第7任中川幸庵','第9任近藤喜一1','第9任近藤喜一2','第9任近藤喜一3','第11任森澤清1','第11任森澤清2','第12任大井司','第13任苗加寬三1','第13任苗加寬三2','第13任苗加寬三3','第14任佐藤敏1','第14任佐藤敏2','第15任新免勝1','第15任新免勝2','第15任新免勝3','竹東第1任羅欽憲院長就職典禮'];

            // Func : SetData
            // Desc : 設定文物資訊面板的內容
            function SetData(thisIndex, arrow) {
                //console.log('thisIndex: '+thisIndex);
                index = thisIndex;
                var dbData = _Data[index];
                function pass_event() {
                    // 添加类型检查和默认值
                    if (typeof index === 'undefined') index = '00';
                    if (typeof len === 'undefined') len = 0;
                    
                    //console.log('index: ' + index);
                    
                    const maxAttempts = 100;
                    let attempts = 0;
                    
                    // 使用迭代代替遞歸，避免棧溢出
                    while (attempts < maxAttempts) {
                        attempts++;
                        
                        // 檢查數據是否有效
                        if (dbData?.photos !== undefined) {
                            return true;
                        }
                        
                        // 處理索引切換邏輯
                        let currentIndex = parseInt(index, 10);
                        
                        if (arrow === 'left') {
                            currentIndex = (currentIndex === 0) ? len : currentIndex - 1;
                        } else {
                            currentIndex = (currentIndex >= len) ? 0 : currentIndex + 1;
                        }
                        
                        // 格式化索引爲兩位數
                        index = currentIndex.toString().padStart(2, '0');
                        
                        // 獲取新數據
                        dbData = _Data[index];
                    }
                    
                    console.error('Max attempts reached, no valid data found');
                    return false;
                }
                pass_event();

                if(dbData["date"] !== undefined) {
                    $("#Label_Date").html(dbData["date"]);
                    $("#Label_Subject_title").html(dbData["subject"]["title"]);
                    $("#Label_Subject_hospital").html(dbData["subject"]["hospital"]);
                    $("#Label_Subject_period").html(dbData["subject"]["period"]);
                    $("#Label_Summary").html(dbData["summary"]);

                    // 處理文物圖檔
                    $("#List_Photo div").html('');
                    for (var i = 0; i < dbData["photos"].length; i++) {
                        $("#List_Photo .scroll").append('<img class="img-fluid photo" src="./data/Official/4/'+dbData["photos"][i]+'.webp" big="/data/Official/4/'+dbData["photos"][i]+'.webp" alt="">');
                    };
                    $("#Big_Photo").html('');

                    var setbigpic = '';
                    for(i = 0; i < urls.length; i++){
                        if(dbData["photos"][0] === urls[i]) setbigpic = ' big_pic';
                    }
                    $("#Big_Photo").append('<img class="img-fluid photo'+ setbigpic +'" src="./data/Official/4/'+dbData["photos"][0]+'.webp" alt="">');
                    $("#List_Photo .photo").first().addClass('active');
                    
                    $("#Big_Photo .photo").extm({
                        squareOverlay:true,
                    });
                }else{
                    SetData(thisIndex, 'default');
                }
            }

            // Func : ClearData
            // Desc : 清除文物資訊面板的內容
            function Clear_Data() {
                $("#Label_Date, #Label_Subject_title, #Label_Subject_hospital, #Label_Subject_period, #Label_Summary, #Big_Photo, #List_Photo .scroll").html('');
            }

            SetListHTML();

            $(window).on('load resize scroll', function() {
                var wW = parseInt($(window).width());
                var hW = $('#header').width();
                if (wW > hW) {
                    $('#float_nav').css('margin-left', (wW - hW) / 2);
                }
                var hH = $('#header').height();
                var fp = $('#footer');
                var fpos = fp.position();
                var wH = parseInt($(window).height());
                if ($(this).scrollTop() > hH) {
                    if ($(this).scrollTop() > (fpos.top - wH / 2 - 236)) {
                        $('#float_nav').removeClass('active');
                    } else {
                        $('#float_nav').addClass('active');
                    }
                } else {
                    $('#float_nav').removeClass('active');
                }
            });

            $('#infomation').mCustomScrollbar({
                theme: "minimal-dark"
            });

            $(window).on('click', '.h_link', function() {
                index = $(this).attr('data-index');
                $('#svgAll .connection-svg path').removeClass('black');
                $('#svgAll .connection-svg path').eq(i-1).addClass('black');
            });

            $('#history1').on('mouseover', '.h_link', function() {
                var idex = $(this).attr('data-index');
                //console.log(idex);
                $('#svgAll .connection-svg path').eq(idex-1).addClass('black');
            });
            $('#history1').on('mouseout', '.h_link', function() {
                var idex = $(this).attr('data-index');
                $('#svgAll .connection-svg path').eq(idex-1).removeClass('black');
            });

            $('#List_Photo').on('click', '.photo', function(e) {
                $('#oElement').remove();

                $('#List_Photo .photo').removeClass('active');
                $(this).addClass('active');
                $('#Big_Photo').html('');
                var big = $('#List_Photo .photo.active').attr('big');

                var setbigpic = '';
                for(i = 0; i < urls.length; i++){
                    if(big === '/data/Official/4/' + urls[i] +'.webp') setbigpic = ' big_pic';
                }
                
                var pathname = window.location.pathname;
                var path1 = pathname.substring(0, pathname.lastIndexOf('/'));
                var url = location.origin + path1;
                $("#Big_Photo").append('<img class="img-fluid photo'+ setbigpic +'" src="'+ url + big +'" alt="">');

                $("#Big_Photo .photo").extm({
                    squareOverlay:true,
                });
            });


            $('#showModal').on('shown.bs.modal', function(event) {
                var num = $(event.relatedTarget);
                index = num.data("index");
                // console.log('index : '+index);
                SetData(index, 'default');
            });
            
            $('#showModal .close').click(function(){
                $('#oElement').remove();
                Clear_Data();
            });

            $('#button_left').on('click', function() {
                $('#oElement').remove();
                Clear_Data();

                var len = $('.h_link').length;
                index = parseFloat(index) - 1;
                if(index == 0) index = len;
                if(index > len) index = 1;
                if(index < 10) index = "0" + index;
                index = index.toString();
                // console.log('index1 : '+index);
                SetData(index, 'left');
            });

            $('#button_right').on('click', function() {
                $('#oElement').remove();
                Clear_Data();

                var len = $('.h_link').length;
                index = parseFloat(index) + 1;
                if(index == 0) index = len;
                if(index > len) index = 1;
                if(index < 10) index = "0" + index;
                index = index.toString();
                // console.log('index2 : '+index);
                SetData(index, 'default');
            });

            $('#List_Photo').on('click', '.photo.active', function() {
                var pathname = window.location.pathname;
                var path1 = pathname.substring(0, pathname.lastIndexOf('/'));
                var url = location.origin + path1 + $(this).attr('big');
                //console.log('url : '+ url);
                if($(this).attr('big') !== undefined){
                    window.open(url, '_blank').focus();
                }
            });

            $('.btns .btn').click(function() {
                let hid = $(this).attr('item');
                let htop = $('#'+hid).offset();
                $('html, body').animate({
                    scrollTop: htop.top - 50
                }, 1500, 'easeInOutExpo');
                return false;
            });

            $(window).on('load resize', function() {
                $('#svgAll .connection-svg path').remove();
                $('#hr_list .h_link').each(function(i){
                    var point1 = $(this).find('.point1');
                    var point2 = $(this).find('.hospital');
                    var style = 'hvh';
                    var color = 'line1';
                    if(i == 10 || i == 15 || i == 16 || i == 19 || i == 21 || i == 23 || i == 34 || i == 35 || i == 36 || i == 39){
                        style = 'vh';
                    }
                    if(i > 29 && i < 40){
                        color = 'line2';
                    }
                    if(i == 40){
                        color = 'line3';
                    }
                    if(i > 40){
                        color = 'line4';
                    }
                    connectionLines('#history1', point1, point2, color, style, i);
                });
            });

        });
    </script>

</body>

</html>